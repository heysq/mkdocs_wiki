### 事务四大特性
- 隔离性
- 一致性
- 原子性
- 持久性

### 事务同时存在产生的问题
- 脏读
- 幻读
- 不可重复读

### 标准事务隔离级别
- 读未提交：一个事务还没提交时，它做的变更就能被别的事务看到
- 读提交：一个事务提交之后，它做的变更才会被其他事务看到。
- 可重复读：一个事务执行过程中看到的数据，总是跟这个事务在启动时看到的数据是一致的。当然在可重复读隔离级别下，未提交变更对其他事务也是不可见的
- 串行化：按顺序执行事务，不并发执行

### 视图创建
- 可重复度：在事务启动的时候创建
- 读提交：在sql开始执行的时候创建视图
- 读未提交：直接读取记录的最新值，不用创建视图
- 串行化：用加锁来控制事务，不需要视图

### MVCC
- 每次对记录更新时，都会记录一条回滚日志。通过回滚日志可以将记录还原到更新前的状态
- 一条数据库记录，在多个事务中会有不同的版本，不同的read-view

### 事务的启动方式
- begin 或 start transaction。配套的提交语句是 commit，回滚语句是 rollback
- set autocommit=0，这个命令会将这个线程的自动提交关掉。事务持续存在直到主动执行 commit 或 rollback 语句或断开链接
- commit work and chain 语法 提交一个事务后自动开启下一个事务

### 事务版本控制

![](/images/mysql/事务隔离.png)

### 读取数据时，数据版本与事务视图
- 版本未提交，不可见
- 数据版本已经提交，但是是在事务视图创建后提交的，不可见
- 数据版本已经提交，在事务视图创建之前提交的，可见

### 更新数据时，数据版本与事务视图
- 更新数据时，不能在历史版本上更新，会导致新版本已经提交的事务更新失效
- 更新数据都是先读后写的，只能用当前读，也就是读当前的值
- select 语句加了 `for update`或者是`lock in share mode` 也是当前读
- 两个事务同时更新同一行数据，先启动的时候会持有MDL

