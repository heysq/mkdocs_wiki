### Scan 命令
- 复杂度为O(n)，通过游标分步进行，并不会阻塞主线程
- 提供limit参数，可以控制每次返回结果的最大数，实际返回的结果可多可少
- 提供模式匹配功能
- 游标状态保留在客户端
- 返回的数据可能有重复，需要客户端去重
- 遍历过程中有数据修改，改动后的数据不确定能不能查找到
- 游标再次返回为0，才表示遍历结束

### 返回的结果数不等于limit数量
- limit只是限定每次scan遍历的hash槽的数量
- 最大层存有所有key的hash的槽数
- 每一次遍历都会将 limit 数量的槽位上挂接的所有链表元素进行模式匹配过滤后,一次性返回给客户端

### scan 遍历顺序
- 高位进位加法
- 与普通的加法正好进位方向相反
- 使用普通加法字段扩容进行rehash时，会产生重复或遗漏
- rehash的map进行遍历时，会同时查询新旧多个槽位有没有符合要求的数据

### hash 2倍扩容
- 原来的数组中的数据被分散到2个数组中
- 用高位加0和加1的方式

![](http://image.heysq.com/wiki/redis/rehash.png)

### 扩缩容前后高位加法遍历顺序
- 采用高位进位加法的遍历顺序，rehash后的槽位遍历顺序上是相邻的
- 扩容后即将遍历的槽位之前的槽都是已经遍历过的了，可以避免对之前的槽进行重复遍历 0110之前的槽都遍历过了
- 缩容不会重复遍历之前已经遍历过的槽，但是会对当前槽的数据进行重复遍历，10之前的槽遍历过了，但是10这个槽的数据会重复遍历一次

![](http://image.heysq.com/wiki/redis/scan.png)

#### 更多的scan
- hscan
- zscan
- sscan